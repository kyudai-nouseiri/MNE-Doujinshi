
## コンピュータクラスタ(計算量が膨大な場合)

これはMNEpythonの為にはほぼ要らないと言えるのですが、
一応記しておきます。どういうものかというと、複数のコンピュータを
束ねて計算をするという、ドラゴンボールの元気玉みたいな技です。
 
以下、UBUNTU16.04以上を想定して書きます。
パソコン初心者とかにとっては敷居高いかもしれません。

やり方としてはまずnfsを使ってディスクを共有します
僕はホームディレクトリをそのまま共有しました。共有元ではこうです。

```{frame=single}
apt install nfs-kernel-server
```

次に、/etc/exportsを書き換えます。

```{frame=single}
/home/hoge/ fuga(rw)
```

ディレクトリ、ip、オプションの順です。詳しくはググって下さい。

次に共有先のコンピュータをいじります。
まず、他のコンピュータのディスクを読むためのソフトをインストールします。

```{frame=single}
apt install nfs-common
```

そして、起動時にそのホームディレクトリを読みに行くように設定します。
具体的には/etc/fstabをいじります。homeディレクトリを他のところから読む設定です。
fugaは他のコンピュータのip、hogeは

```{frame=single}
fuga:/home/hoge /home/piyo ext4 rw 0 0
```

あとは再起動すれば、毎回ホームディレクトリが共有されます。
必ず共有元を先に起動するようにしてください。（実はクラスタやめる時に一寸面倒くさいです）
通信方式はsshを使うのでssh-agentを使えるようにします。まず、秘密鍵と公開鍵を作ります。[^kagi]

```{frame=single}
ssh-keygen -t rsa
```

[^kagi]:いわゆる鍵認証方式というやり方です。セキュリティと利便性を両立できる良いやり方であり、
クラスタ作る時に限らず日常生活の中でもお勧めです。パスワード入れなくてもいいので楽ですし。

ssh-addコマンドで鍵を登録することが出来ます。

```{frame=single}
ssh-add hoge/fuga
```

下記のコマンドでちゃんと登録できたか確認できます。

```{frame=single}
ssh-add -l
```

下記のコマンドでSSH-agentを起動出来ます。

```{frame=single}
eval `ssh-agent`
```

また、ssh-agentは-Aオプションつけてやるのがお勧めですが、これはまた別の話。
sshはネットワークの基礎的な技術なので、本書ではここまでにしておきます。
詳しい事はインターネット上に分かりやすい記事がたくさんあると思いますので、検索してみて下さい。

あとはipyparallelの機能を用いて並列計算します。ipyparallelをインストールしましょう。
```{frame=single}
conda install ipyparallel
```
pipでも良いみたいです。ずっと先でこれの使い方を解説します。

下記の公式サイトの説明の通りにしていけば良いです。
https://ipyparallel.readthedocs.io/en/latest/

とはいえ、英語の公式サイトを見ながらゴリゴリ設定する…というのもきついものがあります。
ネット上ではこの記事などが参考になります。
http://qiita.com/chokkan/items/750cc12fb19314636eb7

何故か僕がやると正攻法で動いてくれなかったので、下記のやり方をとりました。
http://qiita.com/uesseu/items/def93d1a0e829aec8e86
